<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Poladent Control</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<!-- QR -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<style>
body{font-family:Arial;background:#f0f8ff;margin:0}
header{background:#3aa6ff;color:white;padding:15px;text-align:center}
button{background:#3aa6ff;color:white;border:none;padding:10px 15px;border-radius:8px;margin:5px;cursor:pointer}
input{padding:10px;margin:5px;border-radius:6px;border:1px solid #ccc;width:90%}
.panel{display:none;padding:20px}
.card{background:white;padding:15px;border-radius:12px;margin-bottom:10px;box-shadow:0 4px 10px rgba(0,0,0,0.1)}
#logo{max-width:160px;margin:10px auto;display:block}
.eye{cursor:pointer;margin-left:-30px}
#notificacionesAdmin{position:fixed;top:20px;right:20px;z-index:9999}
.notificacion{background:#e6f4ff;border-left:6px solid #3aa6ff;padding:12px;margin-bottom:10px;border-radius:8px}
.empleadoItem{display:flex;justify-content:space-between;align-items:center;margin:5px 0}
.borrar{background:#ff4d4d}
#nombreGrande{text-align:center;font-size:1.5em;margin-bottom:10px}
</style>
</head>

<body>

<header>
<img id="logo">
<h2>Poladent ‚Äì Control de Asistencia</h2>
</header>

<!-- LOGIN ADMIN -->
<div id="login" class="panel" style="display:block">
  <div class="card">
    <h3>Administrador</h3>
    <input type="password" id="adminPass" placeholder="Contrase√±a">
    <span class="eye" onclick="togglePass('adminPass')">üëÅ</span><br>
    <button onclick="loginAdmin()">Entrar</button>
  </div>
</div>

<!-- ADMIN -->
<div id="admin" class="panel">
  <div class="card">
    <h3>Panel Administrador</h3>
    <button onclick="logout()">Cerrar sesi√≥n</button>
  </div>

  <!-- LOGO -->
  <div class="card">
    <h4>Logo de la empresa</h4>
    <input type="file" id="logoInput">
    <button onclick="subirLogo()">Subir / Cambiar logo</button>
  </div>

  <!-- EMPLEADOS -->
  <div class="card">
    <h4>Registrar empleado</h4>
    <input id="empNombre" placeholder="Nombre">
    <input type="password" id="empPin" placeholder="PIN">
    <span class="eye" onclick="togglePass('empPin')">üëÅ</span><br>
    <button onclick="crearEmpleado()">Guardar</button>
  </div>

  <div class="card">
    <h4>Empleados registrados</h4>
    <div id="listaEmpleados"></div>
  </div>

  <!-- QR -->
  <div class="card">
    <h4>C√≥digo QR del escritorio</h4>
    <div id="qrcode"></div>
  </div>
</div>

<!-- EMPLEADO -->
<div id="empleado" class="panel">
  <div class="card">
    <h2 id="nombreGrande"></h2>
    <button onclick="marcar('Entrada','Buen trabajo üíô')">Entrada</button>
    <button onclick="marcar('Almuerzo','Buen provecho üçΩÔ∏è')">Almuerzo</button>
    <button onclick="marcar('Regreso','Buen regreso üí™')">Regreso</button>
    <button onclick="marcar('Salida','Gracias por tu trabajo üëè')">Salida</button>
  </div>
</div>

<div id="notificacionesAdmin"></div>

<script>
// üî• CONFIGURA TU FIREBASE
var firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_PROYECTO.firebaseapp.com",
  databaseURL: "https://TU_PROYECTO.firebaseio.com",
  projectId: "TU_PROYECTO",
  storageBucket: "TU_PROYECTO.appspot.com"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const storage = firebase.storage();
let empleadoActual = "Empleado";

// LOGIN
function loginAdmin(){
  if(adminPass.value==="Poladen2026"){
    login.style.display="none";
    admin.style.display="block";
    cargarEmpleados();
    cargarLogo();
    generarQR();
  } else alert("Contrase√±a incorrecta");
}

function logout(){ location.reload(); }

// LOGO
function subirLogo(){
  const file = document.getElementById("logoInput").files[0];
  if(!file){ alert("Selecciona una imagen"); return; }
  const ref = storage.ref("logo.png");
  ref.put(file).then(()=>{
    ref.getDownloadURL().then(url=>{
      db.ref("config/logoURL").set(url);
      logo.src = url;
    });
  });
}

function cargarLogo(){
  db.ref("config/logoURL").once("value", s=>{
    if(s.exists()) logo.src = s.val();
  });
}

// EMPLEADOS
function crearEmpleado(){
  if(!empNombre.value || !empPin.value) return;
  const ref = db.ref("empleados").push();
  ref.set({nombre: empNombre.value, pin: empPin.value});
  empNombre.value=""; empPin.value="";
}

function cargarEmpleados(){
  db.ref("empleados").on("value", snap=>{
    listaEmpleados.innerHTML="";
    snap.forEach(e=>{
      const id = e.key;
      const d = e.val();
      listaEmpleados.innerHTML += `
        <div class="empleadoItem">
          <div>${d.nombre} - PIN: <b>${d.pin}</b></div>
          <button class="borrar" onclick="borrarEmpleado('${id}')">üóë</button>
        </div>`;
    });
  });
}

function borrarEmpleado(id){
  if(confirm("¬øBorrar este empleado?")){
    db.ref("empleados/"+id).remove();
  }
}

// MARCACIONES
function marcar(tipo, mensaje){
  const n = new Date();
  db.ref("marcaciones").push({
    nombre: empleadoActual,
    tipo: tipo,
    hora: n.toLocaleTimeString(),
    fecha: n.toLocaleDateString()
  });

  db.ref("notificaciones").push({
    nombre: empleadoActual,
    tipo: tipo,
    hora: n.toLocaleTimeString(),
    fecha: n.toLocaleDateString()
  });

  alert(mensaje);
}

// NOTIFICACIONES
db.ref("notificaciones").limitToLast(1).on("child_added", s=>{
  const d = s.val();
  const div = document.createElement("div");
  div.className="notificacion";
  div.innerHTML=`<b>${d.nombre}</b><br>${d.tipo}<br>${d.fecha} ${d.hora}`;
  notificacionesAdmin.appendChild(div);
  setTimeout(()=>div.remove(),8000);
});

// QR
function generarQR(){
  qrcode.innerHTML="";
  new QRCode(qrcode,{
    text: window.location.href,
    width:180,
    height:180
  });
}

// OJO
function togglePass(id){
  const i=document.getElementById(id);
  i.type = i.type==="password" ? "text" : "password";
}
</script>

</body>
  </html>
