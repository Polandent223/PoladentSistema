<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ü¶∑ Poladent Empleado</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
body{font-family:Arial;background:#f0f8ff;margin:0}
header{background:#3aa6ff;color:white;padding:15px;text-align:center}
button{background:#3aa6ff;color:white;border:none;padding:10px 15px;border-radius:8px;margin:5px;cursor:pointer;width:45%}
input{padding:10px;margin:5px;border-radius:6px;border:1px solid #ccc;width:90%}
.panel{display:none;padding:20px}
.card{background:white;padding:15px;border-radius:12px;margin-bottom:10px;box-shadow:0 4px 10px rgba(0,0,0,0.1)}
#nombreGrande{text-align:center;font-size:1.8em;margin-bottom:15px}
.notificacion{background:#e6f4ff;border-left:6px solid #3aa6ff;padding:12px;margin-bottom:10px;border-radius:8px}
#notiEmpleado{position:fixed;top:20px;right:20px;z-index:9999;width:250px}
.eye{cursor:pointer;margin-left:-30px}
</style>
</head>
<body>

<header>
<h2>ü¶∑ Poladent Empleado ü¶∑</h2>
</header>

<!-- Login Empleado -->
<div id="login" class="panel" style="display:block">
  <div class="card">
    <h3>Empleado</h3>
    <input id="empNombreLogin" placeholder="Nombre">
    <input type="password" id="empPinLogin" placeholder="PIN">
    <span class="eye" onclick="togglePass('empPinLogin')">üëÅ</span><br>
    <button onclick="loginEmpleado()">Entrar</button>
  </div>
</div>

<!-- Panel Empleado -->
<div id="empleado" class="panel">
  <div class="card">
    <h2 id="nombreGrande"></h2>
    <button onclick="marcar('Entrada','Buen trabajo üíô')">Entrada</button>
    <button onclick="marcar('Almuerzo','Buen provecho üçΩÔ∏è')">Almuerzo</button>
    <button onclick="marcar('Regreso','Buen regreso üí™')">Regreso</button>
    <button onclick="marcar('Salida','Gracias por tu trabajo üëè')">Salida</button>
    <br><button onclick="logout()">Cerrar sesi√≥n</button>
  </div>
  <div class="card">
    <h4>Mis √∫ltimas marcaciones</h4>
    <div id="misMarcaciones"></div>
  </div>
</div>

<div id="notiEmpleado"></div>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyAFOyMEo2SgWpcs8WHp2nKCO_ax9-lYZWo",
  authDomain: "poladent-5fa13.firebaseapp.com",
  databaseURL: "https://poladent-5fa13-default-rtdb.firebaseio.com",
  projectId: "poladent-5fa13",
  storageBucket: "poladent-5fa13.firebasestorage.app",
  messagingSenderId: "539152567873",
  appId: "1:539152567873:web:89c67ebb14bd55a77900c0",
  measurementId: "G-XS7W8B86WY"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();
let empleadoActual="";

// Login empleado
function loginEmpleado(){
  const nombre=empNombreLogin.value.trim();
  const pin=empPinLogin.value.trim();
  if(!nombre || !pin){alert("Ingrese nombre y PIN"); return;}
  db.ref("empleados").orderByChild("nombre").equalTo(nombre).once("value",snap=>{
    let valido=false;
    snap.forEach(e=>{
      const d=e.val();
      if(d.pin===pin){valido=true; empleadoActual=nombre;}
    });
    if(valido){login.style.display="none";empleado.style.display="block";document.getElementById("nombreGrande").innerText=empleadoActual;cargarMisMarcaciones();}
    else alert("Nombre o PIN incorrecto");
  });
}

function logout(){location.reload();}
function togglePass(id){const i=document.getElementById(id);i.type=i.type==="password"?"text":"password";}

// Marcar entrada, almuerzo, regreso, salida
function marcar(tipo,mensaje){
  if(!empleadoActual) return;
  const n=new Date();
  let lat=0, lng=0;
  if(navigator.geolocation){navigator.geolocation.getCurrentPosition(p=>{lat=p.coords.latitude; lng=p.coords.longitude; guardarMarcacion(tipo,mensaje,n,lat,lng);},()=>{guardarMarcacion(tipo,mensaje,n,lat,lng);});} 
  else guardarMarcacion(tipo,mensaje,n,lat,lng);
}

function guardarMarcacion(tipo,mensaje,n,lat,lng){
  db.ref("marcaciones").push({nombre:empleadoActual,tipo:tipo,hora:n.toLocaleTimeString(),fecha:n.toLocaleDateString(),lat:lat,lng:lng});
  db.ref("notificaciones").push({nombre:empleadoActual,tipo:tipo,hora:n.toLocaleTimeString(),fecha:n.toLocaleDateString()});
  mostrarNotificacion(mensaje);
  cargarMisMarcaciones();
}

// Mis √∫ltimas marcaciones
function cargarMisMarcaciones(){
  db.ref("marcaciones").orderByChild("nombre").equalTo(empleadoActual).limitToLast(10).once("value",snap=>{
    misMarcaciones.innerHTML="";
    snap.forEach(e=>{
      const d=e.val();
      misMarcaciones.innerHTML+=`<div class="notificacion">${d.tipo} - ${d.fecha} ${d.hora}</div>`;
    });
  });
}

// Notificaci√≥n simple
function mostrarNotificacion(texto){
  const div=document.createElement("div");div.className="notificacion";div.innerText=texto;
  notiEmpleado.appendChild(div); setTimeout(()=>div.remove(),5000);
}
</script>
</body>
</html>
